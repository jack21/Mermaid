--   -------------------------------------------------- 
--   Generated by Enterprise Architect Version 7.5.848
--   Created On : 星期三, 03 三月, 2010 
--   DBMS       : MySql 
--   -------------------------------------------------- 


SET FOREIGN_KEY_CHECKS=0;



--  Create Tables 
CREATE TABLE ContractOut
(
	ContractOutId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	ContractOutCode VARCHAR(50) NOT NULL COMMENT '發包代號(Food是FoodId, 如果 Food 有 Cooking 是 CookingId)',
	PrinterId INTEGER NOT NULL COMMENT '出單機',
	PRIMARY KEY (ContractOutId),
	KEY (PrinterId),
	INDEX ID_ContractOutCode (ContractOutCode ASC)
)  COMMENT='廚房出單';


CREATE TABLE Cooking
(
	CookingId INTEGER NOT NULL AUTO_INCREMENT COMMENT '烹調方式PK',
	CookingName VARCHAR(20) NOT NULL COMMENT '烹調方式',
	IsDelete VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '是否刪除: 00=未刪除, 01=刪除',
	PRIMARY KEY (CookingId),
	UNIQUE UQ_Cooking_CookingId(CookingId)
)  COMMENT='烹調方式';


CREATE TABLE CurrentOrder
(
	CurrentOrderId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	FoodOrderId INTEGER COMMENT 'FK',
	PRIMARY KEY (CurrentOrderId),
	UNIQUE UQ_CurrentOrderFoodOrder(FoodOrderId),
	KEY (FoodOrderId)
)  COMMENT='用餐中訂單';


CREATE TABLE Employee
(
	EmployeeId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	Name VARCHAR(50) NOT NULL COMMENT '姓名',
	EmployeeCode VARCHAR(10) NOT NULL COMMENT '員工編號(數字)',
	Password VARCHAR(20) NOT NULL COMMENT '密碼',
	Admin VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '系統管理功能: 00=否, 01=是',
	Order VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '點菜功能: 00=否, 01=是',
	Checkout VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '結帳功能: 00=否, 01=是',
	Report VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '報表功能: 00=否, 01=是',
	MonthReport VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '超級報表功能: 00=否, 01=是',
	Employee VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '員工資料功能: 00=否, 01=是',
	Eraser VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '清除所有資料: 00=否, 01=是',
	DeleteOrder VARCHAR(2) COMMENT '刪除點菜內容: 00=否, 01=是',
	IsDelete VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '是否刪除: 00=未刪除, 01=刪除',
	PRIMARY KEY (EmployeeId),
	INDEX ID_Employee_EmployeeCode (EmployeeCode ASC),
	INDEX ID_Employee_IsDelete (IsDelete ASC)
)  COMMENT='員工';


CREATE TABLE Food
(
	FoodId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	Name VARCHAR(100) NOT NULL COMMENT '菜名',
	Code VARCHAR(20) NOT NULL COMMENT '食物代碼',
	Type VARCHAR(2) NOT NULL COMMENT '類型: 01=活海鮮, 02=熱炒類, 03=鐵板類, 04=油炸類, 05=推薦料理, 06=飯麵類, 07=火鍋類, 08=湯羹類, 09=三杯類, 10=青菜類, 11=燒烤類, 12=位上篇, 13=點心類, 14=冷盤類, 60=小菜, 70=合菜, 80=酒水, 90=其他類',
	Unit VARCHAR(10) NOT NULL COMMENT '單位',
	Large INTEGER COMMENT '大份價錢',
	Middle INTEGER COMMENT '中盤價錢',
	Small INTEGER COMMENT '小盤價錢',
	IsDelete VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '是否刪除: 00=未刪除, 01=刪除',
	PRIMARY KEY (FoodId),
	INDEX ID_FoodCode (Code ASC),
	INDEX ID_FoodType (Type ASC),
	INDEX ID_Food_IsDelete (IsDelete ASC)
)  COMMENT='菜盤';


CREATE TABLE FoodOrder
(
	FoodOrderId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	TablesId INTEGER COMMENT 'FK',
	EmployeeId INTEGER NOT NULL COMMENT 'FK',
	DailySerial INTEGER NOT NULL COMMENT '日序號',
	CustomerCount INTEGER NOT NULL DEFAULT 0 COMMENT '人數',
	FullFoodFee DOUBLE DEFAULT 0 COMMENT '餐時費用(含招待)',
	FoodFee DOUBLE DEFAULT 0 COMMENT '餐食費用',
	FullSideDishesFee DOUBLE DEFAULT 0 COMMENT '小菜費用(含招待)',
	SideDishesFee DOUBLE DEFAULT 0 COMMENT '小菜費用',
	FullDrinkFee DOUBLE DEFAULT 0 COMMENT '酒水費用(含招待)',
	DrinkFee DOUBLE DEFAULT 0 COMMENT '酒水費用',
	FullOtherFee DOUBLE DEFAULT 0 COMMENT '其他費用(含招待)',
	OtherFee DOUBLE DEFAULT 0 COMMENT '其他費用',
	ServiceFee DOUBLE DEFAULT 0 COMMENT '服務費',
	FreeFee DOUBLE DEFAULT 0 COMMENT '招待金額',
	TotalFee DOUBLE DEFAULT 0 COMMENT '應收金額',
	ServiceRate DOUBLE NOT NULL DEFAULT 0 COMMENT '服務費百分比(數值表示百分比，10實際表示10%)',
	Deposit DOUBLE DEFAULT 0 COMMENT '訂金',
	Discount DOUBLE DEFAULT 0 COMMENT '折讓',
	CashPay DOUBLE DEFAULT 0 COMMENT '現金金額',
	CreditCardPay DOUBLE DEFAULT 0 COMMENT '刷卡金額',
	DebtPay DOUBLE DEFAULT 0 COMMENT '簽帳金額',
	TotalPay DOUBLE DEFAULT 0 COMMENT '實收',
	CheckOutTime DATETIME COMMENT '結帳時間',
	BuildTime DATETIME NOT NULL COMMENT '建立時間',
	Visible VARCHAR(2) NOT NULL DEFAULT 01 COMMENT '是否看得到: 00=看不到, 01=看得到',
	PRIMARY KEY (FoodOrderId),
	KEY (EmployeeId),
	KEY (TablesId)
)  COMMENT='訂單';


CREATE TABLE GlobalProp
(
	GlobalPropId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	PropName VARCHAR(30) NOT NULL COMMENT '參數名',
	PropValue VARCHAR(255) NOT NULL COMMENT '參數值',
	PRIMARY KEY (GlobalPropId)
)  COMMENT='系統參數';


CREATE TABLE ItemCooking
(
	ItemCookingId INTEGER NOT NULL AUTO_INCREMENT COMMENT '訂單烹調方式PK',
	OrderItemId INTEGER NOT NULL,
	CookingId INTEGER NOT NULL,
	PRIMARY KEY (ItemCookingId),
	UNIQUE UQ_ItemCooking_ItemCookingId(ItemCookingId),
	KEY (CookingId),
	KEY (OrderItemId)
)  COMMENT='訂單烹調方式';


CREATE TABLE OrderItem
(
	OrderItemId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	FoodId INTEGER COMMENT 'FK',
	FoodOrderId INTEGER COMMENT 'FK',
	IsReturn VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '退貨: 00=未退貨, 01=已退貨',
	UnitSize VARCHAR(2) NOT NULL COMMENT '大中小: 00=小, 01=中, 02=大',
	Discount VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '招待: 00=否, 01=是',
	Count DOUBLE NOT NULL DEFAULT 1 COMMENT '數量',
	Fee DOUBLE NOT NULL DEFAULT 0 COMMENT '單價',
	CookingNames VARCHAR(50) COMMENT '作法',
	IsContractOut VARCHAR(2) NOT NULL DEFAULT 02 COMMENT '已出單: 00=未出單, 01=已出單, 02=不用出單',
	PRIMARY KEY (OrderItemId),
	KEY (FoodId),
	KEY (FoodOrderId)
)  COMMENT='訂單內容';


CREATE TABLE Printer
(
	PrinterId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	PrinterName VARCHAR(200) NOT NULL COMMENT '印表機名稱',
	Port VARCHAR(50) COMMENT '印表機埠',
	Note VARCHAR(50) NOT NULL COMMENT '印表機用途',
	IsDelete VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '是否刪除: 00=未刪除, 01=已刪除',
	PRIMARY KEY (PrinterId),
	INDEX ID_PrinterDelete (IsDelete ASC)
)  COMMENT='出單機';


CREATE TABLE Restaurant
(
	RestaurantId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	Name VARCHAR(50) NOT NULL COMMENT '餐廳名稱',
	PRIMARY KEY (RestaurantId),
	UNIQUE UQ_Restauraut_Name(Name)
)  COMMENT='餐廳';


CREATE TABLE Tables
(
	TablesId INTEGER NOT NULL AUTO_INCREMENT COMMENT 'PK',
	RestaurantId INTEGER COMMENT 'FK',
	Name VARCHAR(50) NOT NULL COMMENT '桌名',
	Location INTEGER NOT NULL COMMENT '擺放順序',
	IsDelete VARCHAR(2) NOT NULL DEFAULT 00 COMMENT '是否刪除: 00=未刪除, 01=刪除',
	PRIMARY KEY (TablesId),
	KEY (RestaurantId),
	INDEX ID_Tables_Location (Location ASC),
	INDEX ID_Tables_IsDelete (IsDelete ASC)
)  COMMENT='餐桌';



SET FOREIGN_KEY_CHECKS=1;


--  Create Foreign Key Constraints 
ALTER TABLE ContractOut ADD CONSTRAINT FK_ContractOut_Printer 
	FOREIGN KEY (PrinterId) REFERENCES Printer (PrinterId);

ALTER TABLE CurrentOrder ADD CONSTRAINT FK_CurrentOrder_FoodOrder 
	FOREIGN KEY (FoodOrderId) REFERENCES FoodOrder (FoodOrderId);

ALTER TABLE FoodOrder ADD CONSTRAINT FK_FoodOrder_Employee 
	FOREIGN KEY (EmployeeId) REFERENCES Employee (EmployeeId);

ALTER TABLE FoodOrder ADD CONSTRAINT FK_FoodOrder_Tables 
	FOREIGN KEY (TablesId) REFERENCES Tables (TablesId);

ALTER TABLE ItemCooking ADD CONSTRAINT FK_ItemCooking_Cooking 
	FOREIGN KEY (CookingId) REFERENCES Cooking (CookingId);

ALTER TABLE ItemCooking ADD CONSTRAINT FK_ItemCooking_OrderItem 
	FOREIGN KEY (OrderItemId) REFERENCES OrderItem (OrderItemId);

ALTER TABLE OrderItem ADD CONSTRAINT FK_OrderItem_Food 
	FOREIGN KEY (FoodId) REFERENCES Food (FoodId);

ALTER TABLE OrderItem ADD CONSTRAINT FK_OrderItem_FoodOrder 
	FOREIGN KEY (FoodOrderId) REFERENCES FoodOrder (FoodOrderId);

ALTER TABLE Tables ADD CONSTRAINT FK_Tables_Restauraut 
	FOREIGN KEY (RestaurantId) REFERENCES Restaurant (RestaurantId);
